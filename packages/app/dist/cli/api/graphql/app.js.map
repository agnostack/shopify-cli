{"version":3,"file":"app.js","sourceRoot":"","sources":["../../../../src/cli/api/graphql/app.ts"],"names":[],"mappings":"AAwBA,MAAM,UAAU,eAAe,CAAC,QAAqC;IACnE,OAAO,QAAQ;QACb,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,aAAa,EAAE,QAAQ,CAAC,OAAO,CAAC;aACrD,MAAM,CAAW,CAAC,cAAc,EAAE,aAAa,GAAG,EAAE,EAAE,EAAE;YACvD,MAAM,YAAY,GAAG,aAAa,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAA;YAC1D,IAAI,YAAY,EAAE;gBAChB,OAAO,CAAC,GAAG,cAAc,EAAE,YAAY,CAAC,CAAA;aACzC;YAED,OAAO,cAAc,CAAA;QACvB,CAAC,EAAE,EAAE,CAAC;aACL,IAAI,CAAC,GAAG,CAAC;QACd,CAAC,CAAC,EAAE,CAAA;AACR,CAAC;AAED,MAAM,UAAU,uBAAuB,CAAC,OAAe,EAAE,gBAA0C;IACjG,MAAM,gBAAgB,GAAG,gBAAgB,EAAE,gBAAgB,CAAA;IAE3D,IAAI,oBAA8B,CAAA;IAClC,IAAI,gBAAgB,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE;QACnD,MAAM,iBAAiB,GAAG,KAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAA;QACjG,oBAAoB,GAAG,iBAAiB,CAAC,MAAM,CAAW,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE;YACtE,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC3B,GAAG,CAAC,IAAI,CAAC,GAAG,OAAO,GAAG,IAAI,EAAE,CAAC,CAAA;aAC9B;YACD,OAAO,GAAG,CAAA;QACZ,CAAC,EAAE,EAAE,CAAC,CAAA;KACP;SAAM;QACL,oBAAoB,GAAG;YACrB,GAAG,OAAO,gBAAgB;YAC1B,GAAG,OAAO,wBAAwB;YAClC,GAAG,OAAO,oBAAoB;SAC/B,CAAA;KACF;IAED,OAAO;QACL,cAAc,EAAE,OAAO;QACvB,oBAAoB;QACpB,GAAG,CAAC,gBAAgB,EAAE,QAAQ,IAAI;YAChC,QAAQ,EAAE;gBACR,GAAG,gBAAgB,EAAE,QAAQ;gBAC7B,0HAA0H;gBAC1H,sEAAsE;gBACtE,GAAG,EAAE,gBAAgB,EAAE,QAAQ,CAAC,GAAG,IAAI,OAAO;aAC/C;SACF,CAAC;KACH,CAAA;AACH,CAAC;AAED,MAAM,UAAU,gBAAgB,CAAC,IAAsB;IACrD,OAAO,CAAC,GAAG,CAAC,iCAAiC,EAAE,IAAI,CAAC,CAAA;IACpD,MAAM,EAAC,QAAQ,EAAE,GAAG,UAAU,EAAC,GAAG,IAAI,CAAA;IACtC,OAAO,CAAC,GAAG,CAAC,sCAAsC,EAAE,UAAU,CAAC,CAAA;IAC/D,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAE,QAAQ,CAAC,CAAA;IAE3D,MAAM,YAAY,GAAuB;QACvC,GAAG,CAAC,QAAQ,EAAE,GAAG,IAAI;YACnB,QAAQ,EAAE,QAAQ,CAAC,GAAG;SACvB,CAAC;QACF,GAAG,CAAC,QAAQ,EAAE,OAAO,IAAI;YACvB,YAAY,EAAE,QAAQ,CAAC,OAAO;SAC/B,CAAC;QACF,iFAAiF;QACjF,mCAAmC;QACnC,gDAAgD;QAChD,MAAM;KACP,CAAA;IACD,OAAO,CAAC,GAAG,CAAC,wCAAwC,EAAE,YAAY,CAAC,CAAA;IAEnE,OAAO;QACL,GAAG,UAAU;QACb,GAAG,YAAY;KAChB,CAAA;AACH,CAAC","sourcesContent":["import {AppUpdate, AppUpdateProxyURLs} from './update_app.js'\n\nexport interface AppProxyUpdate {\n  url?: string\n  subPath?: string\n  // NOTE: AppUpdateInput mutation currently does not support setting subPathPrefix\n  // subPathPrefix?: string\n}\n\nexport interface AppProxy extends AppProxyUpdate {\n  subPathPrefix?: string\n}\n\nexport interface PartnersURLsData {\n  appProxy?: AppProxy\n  applicationUrl: string\n  redirectUrlWhitelist: string[]\n}\n\nexport interface PartnerAppUpdateOptions {\n  authCallbackPath?: string | string[]\n  appProxy?: AppProxyUpdate\n}\n\nexport function conformProxyURL(appProxy: AppProxy | undefined | null): string {\n  return appProxy\n    ? [appProxy.url, appProxy.subPathPrefix, appProxy.subPath]\n        .reduce<string[]>((_proxyURLParts, _proxyUrlPart = '') => {\n          const proxyURLPart = _proxyUrlPart.replace(/^\\/|\\/$/g, '')\n          if (proxyURLPart) {\n            return [..._proxyURLParts, proxyURLPart]\n          }\n\n          return _proxyURLParts\n        }, [])\n        .join('/')\n    : ''\n}\n\nexport function conformPartnersURLsData(baseURL: string, appUpdateOptions?: PartnerAppUpdateOptions): PartnersURLsData {\n  const authCallbackPath = appUpdateOptions?.authCallbackPath\n\n  let redirectUrlWhitelist: string[]\n  if (authCallbackPath && authCallbackPath.length > 0) {\n    const authCallbackPaths = Array.isArray(authCallbackPath) ? authCallbackPath : [authCallbackPath]\n    redirectUrlWhitelist = authCallbackPaths.reduce<string[]>((acc, path) => {\n      if (path && path.length > 0) {\n        acc.push(`${baseURL}${path}`)\n      }\n      return acc\n    }, [])\n  } else {\n    redirectUrlWhitelist = [\n      `${baseURL}/auth/callback`,\n      `${baseURL}/auth/shopify/callback`,\n      `${baseURL}/api/auth/callback`,\n    ]\n  }\n\n  return {\n    applicationUrl: baseURL,\n    redirectUrlWhitelist,\n    ...(appUpdateOptions?.appProxy && {\n      appProxy: {\n        ...appUpdateOptions?.appProxy,\n        // NOTE: AppUpdateInput mutation currently does not support setting subPathPrefix, but does default to 'apps' when updated\n        // subPathPrefix: partnerURLOptions?.appProxy.subPathPrefix ?? 'apps',\n        url: appUpdateOptions?.appProxy.url ?? baseURL,\n      },\n    }),\n  }\n}\n\nexport function conformAppUpdate(data: PartnersURLsData): AppUpdate {\n  console.log(`>>>> > conformAppUpdate > data:`, data)\n  const {appProxy, ...appUpdates} = data\n  console.log(`>>> > conformAppUpdate > appUpdates:`, appUpdates)\n  console.log(`>>> > conformAppUpdate > appProxy:`, appProxy)\n\n  const proxyUpdates: AppUpdateProxyURLs = {\n    ...(appProxy?.url && {\n      proxyUrl: appProxy.url,\n    }),\n    ...(appProxy?.subPath && {\n      proxySubPath: appProxy.subPath,\n    }),\n    // NOTE: AppUpdateInput mutation currently does not support setting subPathPrefix\n    // ...(appProxy?.subPathPrefix && {\n    //   proxySubPathPrefix: appProxy.subPathPrefix,\n    // }),\n  }\n  console.log(`>>> > conformAppUpdate > proxyUpdates:`, proxyUpdates)\n\n  return {\n    ...appUpdates,\n    ...proxyUpdates,\n  }\n}\n"]}